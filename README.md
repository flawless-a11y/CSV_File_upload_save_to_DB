MERCHANT CATALOGUE
It is a microservice that is a part of shopping website backend . This microservice is responsible for onboarding merchants and providing other microservice with the required data it needs for its operation . 
 
 
Schema : Merchant 
Table: merchant_catalogue 
Merchant{ 
merchantId 	integer($int64) 
merchantName 	string 
gstin 	string 
pan 	string 
address 	string 
accountNumber 	integer($int64) 
phoneNumber 	integer($int64) 
created 	string($date-time) 
modified 	string($date-time) 
} 
Primary Key : (gstin) (user defined) 
It is a composite Id to avoid duplicates while parsing the data from the csv file. 
 
 
Foreign Key : (merchantId) (autogenerated) 
This key is to facilitate uniqueness in internal service communications .  
 
 
Field 	Description 
merchantId (Long)  
 
 
Validation : No Validation required as it is generated internally. 
 
 	This is a unique Id that is generated while each record of the csv file is parsed such that each merchant  has an unique identity for internal data exchange/communications/query instead of gstin . 
merchantName (String) 
 
 
Validation : Data is checked that it should only consist of alphabets and spaces , no other characters or symbols are accepted. Should not be null. 	This is user provided data which will be fetched from the csv file uploaded by the client. 
This need not be unique . 
 
 
gstin(String)  
 
 
Validation : This field should not be null and can be made up of Alphanumeric characters but length of string should strictly be 15. 	This is a user provided input which is fetched from a csv file uploaded by the user . This is the primary key used to differentiate duplicate entries and must be unique. 
 
 
pan(String) 
 
 
Validation : can consist of alphanumeric characters and length should be 10. 
 
 	This is a user-provided input fetched from a csv file and needs to be unique . 
address(String) 
 
 
Validation : No validation checks performed  	This is a user-provided input fetched from a csv file and does not need to be unique . 
accountNumber(Long) 
 
 
Validation : Should only contain digits and the length of the number should be between 9 and 16. 	This is a user-provided input fetched from a csv file and does not need to be unique . 
phoneNumber(Long) 
 
 
Validation : Should only contain digits and length should be only 10. 	This is a user-provided input fetched from a csv file and does not need to be unique . 
created(LocalDate) 	It is auto-generated to track the date of entry of merchants into the table. 
modified(LocalDate) 	It is auto-generated to track the date of modification of merchant details in the table. 
 
API 
1 . This API facilitates the upload of merchant data by authorized client by uploading a csv file . 
 
 HTTP Method : POST (/merchant/upload) 
Parameter 	Parameter Type 	Parameter Data Type 	Description 	Required 
authorization 	header 	string 	Access Token  	True 
form-data 	body 	String  	Key value pair is sent in the form data . e.g. -{ 
  "filepath": "absolute file path of the csv file"  
} 	True 
 
curl --location --request POST 'http://localhost:2318/merchant/upload' \ 
--header 'Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTY0OTM2MDk3NSwiZXhwIjoxNjQ5MzcwOTc1fQ.zvKvg2F9Z8I7wk8OFF8oF6ABaUxfqhyxVdi8dMXDs4e3C77ydxRxg2uDI9rJ9SERi1vXPBvEy786dTdv30Aezg' \ 
--form 'filepath="absolute file path'' 
 
 
 
Responses 
Code 	Description 	Sample Response  
200 	File uploaded successfully and data is saved to DB. 	{ 
"status": " Success", 
"message": "Data uploaded and saved successfully File :merchant.csv" 
} 
 
400 	The MIME type of the uploaded file is not correct . 	{ 
"status": " Failure", 
"message": "Please upload a csv file!" 
} 
 
Or  
 
{ 
"status": " Failure", 
"message": "File Doesn't exist" 
} 
 
417 	Something has gone wrong on the website's server , but the server could not be specific on what that exact problem is. 
 	{ 
"status": " Failure", 
"message": "Could not upload the file" 
} 
 
 
 
1.	This API facilitates the fetching of merchant catalogue data all at once in as  anjsonobject and the output is paginated and has option for sorting and  . 
 
 HTTP Method : GET (/merchant) 
Parameter 	Parameter Type 	Parameter Data Type 	Description 	Required 
authorization 	header 	string 	Access Token  	True 
sort 	query 
 	string 	Mentions the field which will be used to sort and direction of sorting e.g. sort=gstin,asc 	Optional 
size 	query 	integer 	No of entries in one page  	Optional 
 
curl --location --request GET 'localhost:2318/merchant/?sort=merchantId,asc&size=2' \ 
--header 'Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTY0OTM5NjkxNywiZXhwIjoxNjQ5NDI2OTE3fQ.5AfJgcB4y3bBCQkawAW946R39yt0ju0ZbGqAGl8BrJGGGG3LdkapTsCXjNdYTYs367LYSM-89CdttJ00VGLOMw' 
 
 
 
 
Responses 
Code 	Description 	Sample Response  
200 	Data retrieved successfully  	{ 
"status": "Success", 
"currentPage": 0, 
"totalItems": 3, 
"totalPages": 2, 
"data": [ 
{ 
    "merchantId": 0, 
    "merchantName": …. 
  },{ 
    "merchantId": 1, 
    "merchantName": …. 
  } ] 
} 
 
204 	Database empty nothing to show (No content found) 	 
417 	Something has gone wrong on the website's server , but the server could not be specific on what that exact problem is. 	 
 
1.	This API facilitates the retrieval of merchant data corresponding to the one or more (list of) merchant ids provided as a path parameter to the endpoint.
 HTTP Method : GET (/merchant/{ids}) 
Parameter 	Parameter Type 	Parameter Data Type 	Description 	Required 
authorization 	header 	string 	Access Token  	True 
ids 	Path-parameter 	List<Integer> 	Ids of the merchant is supplied as a path parameter in the rest query .e.g. : /merchant/3,4  or /merchant/2 	True 
 
curl --location --request GET 'localhost:2318/merchant/1,2' \ 
--header 'Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTY0ODc5NzY4NCwiZXhwIjoxNjQ4ODg0MDg0fQ.zdj-fg_DIKQIx_3vrmZzdZOaZgqydwIblDlFlEgOq1HoA4dx5G178_4adPY5iYgsEDLhxl0tCKkpd8y7u4_sBg' 
 
 
 
Responses 
Code 	Description 	Sample Response  
200 	Data retrieved successfully . 	[ 
  { 
    "merchantId": 0, 
    "merchantName": "string", 
    "gstin": "string", 
    "pan": "string", 
    "address": "string", 
    "accountNumber": 0, 
    "phoneNumber": 0, 
    "created": "2022-04-01T07:05:11.405Z", 
    "modified": "2022-04-01T07:05:11.405Z" 
  } 
] 
 
204 	No Content or the data doesn't exist . 	 
417 	Something has gone wrong on the website's server , but the server could not be specific on what that exact problem is. 
 	 
 
 
JWT AUTHENTICATION  
In our application we have implemented security in the following way : 
•	User can sign up new account with different privileges (admin , moderator , user)  .  
 
•	By User’s role (admin, moderator, user), we authorize the User to access resources (merchant catalogue endpoints ) 
 
•	User can log in using the registered credentials and get the token to access the secured endpoints to perform the upload and data retrieval . 
 
 
 
1.	This API facilitates registration of user with different privileges  .
 HTTP Method : POST (/api/auth/signup) 
Parameter 	Parameter Type 	Parameter Data Type 	Description 	Required 
raw 	body 	Json.dump 	This the user provided data to register himself as a valid user . E.g. 
{ 
   
"username": "string", 
 
  "email": "string", 
 
  "role": [ 
    "string" 
  ], 
 
  "password": "string" 
 
} 	True 
 
curl --location --request POST 'localhost:2318/api/auth/signup' \ 
--header 'Content-Type: application/json' \ 
--data-raw '{ 
    "username": "string", 
    "email": "string", 
    "password": "string", 
    "role": "array list of strings" 
}' 
 
Responses 
Code 	Description 	Sample Response  
200 	User Registered Successfully  	{ "message" : "string"} 
400 	Bad Request  	 
 
 
1.	This API facilitatessigninand token generation  . 
 HTTP Method : POST (/api/auth/signin) 
Parameter 	Parameter Type 	Parameter Data Type 	Description 	Required 
raw 	body 	json.dump 	This the user provided data which was used during signup . E.g. 
{ 
   
"username": "string", 
   
"password": "string" 
 
} 	True 
 
curl --location --request POST 'localhost:2318/api/auth/signin' \ 
--header 'Content-Type: application/json' \ 
--data-raw '{ 
"username": "string", 
"password": "string" 
}' 
 
 
  
Responses 
Code 	Description 	Sample Response  
200 	User Registered Successfully  	{ 
"id":1, 
"username":"admin", 
email":"admin@test.com, 
"roles":["ROLE_ADMIN"], 
"accessToken":"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTY0ODc5ODcwMiwiZXhwIjoxNjQ4ODg1MTAyfQ.kbc4X87V4rULYGDuuhOhnKVPRgx9-kAhUQj0-JBuIE06lLaPIDvGQlWC_e4V8LFL1Ayfk6kngjVpnkGJ6JVSQg", 
"tokenType":"Bearer"} 
 
400 	Bad Request  	 
 
 
 
 
LOGGING 
Logging is done for every request in Common Logging Format (CLF) and is written to the file whose filepath can be configured in application.properties file by setting a value for logFilePath variable . 
E.g. =  
0:0:0:0:0:0:0:1 - - [08/Apr/2022:11:40:31 +0530] "GET /merchant/vgjvj HTTP/1.1" 400 - 
0:0:0:0:0:0:0:1 - - [08/Apr/2022:11:40:33 +0530] "POST /merchant/upload HTTP/1.1" 200 89 
0:0:0:0:0:0:0:1 - - [08/Apr/2022:11:40:37 +0530] "GET /merchant/1,2 HTTP/1.1" 401 - 
0:0:0:0:0:0:0:1 - - [08/Apr/2022:11:40:40 +0530] "GET /merchant/vgjvj HTTP/1.1" 400 - 
0:0:0:0:0:0:0:1 - - [08/Apr/2022:11:40:48 +0530] "GET /merchant/2,3 HTTP/1.1" 200 585 
0:0:0:0:0:0:0:1 - - [08/Apr/2022:11:40:55 +0530] "GET /merchant/ HTTP/1.1" 401 - 
0:0:0:0:0:0:0:1 - - [08/Apr/2022:11:41:14 +0530] "GET /merchant/ HTTP/1.1" 200 585 
 
Format of logging can be configured in configuration class of logger. 
